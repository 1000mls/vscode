steps:
  - script: |
      set -e
      echo "hello world" > $(Build.ArtifactStagingDirectory)/file.txt

  - task: UseDotNet@2
    inputs:
      version: 6.x

  - task: EsrpCodeSigning@2
    displayName: 'ESRP CodeSigning'
    inputs:
      ConnectedServiceName: 'esrp-codesign'
      FolderPath: '$(Build.ArtifactStagingDirectory)'
      Pattern: 'file.txt'
      UseMinimatch: true
      signConfigType: inlineSignParams
      inlineOperation: |
        [
          {
            "keyCode": "CP-401337-Apple",
            "operationCode": "MacAppDeveloperSign",
            "parameters" : [{ "parameterName": "Hardening", "parameterValue": "--options=runtime" }],
            "toolName": "sign",
            "toolVersion": "1.0"
          }
        ]
      SessionTimeout: ${{ parameters.timeoutInMinutes }}
      MaxConcurrency: '50'
      MaxRetryAttempts: '5'
      PendingAnalysisWaitTimeoutMinutes: '5'
